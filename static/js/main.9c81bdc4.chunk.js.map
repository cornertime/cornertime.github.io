{"version":3,"sources":["models.ts","random.ts","speech.ts","settings.ts","state.ts","components/WelcomeScreen.tsx","forms.tsx","serialization.ts","components/PunishmentSetup.tsx","components/PunishmentLoader.tsx","time.ts","components/ReportCard.tsx","components/ReportViewer.tsx","components/App.tsx","index.tsx"],"names":["defaultPreset","title","durationRange","minimum","maximum","penaltyRange","penaltyProbabilities","encouragementProbability","phrases","getReady","start","encourage","scold","penalize","end","randomInteger","min","max","Math","floor","random","randomElement","items","length","BrowserSpeech","phrase","context","utter","SpeechSynthesisUtterance","speechSynthesis","speak","this","MockSpeech","transcript","push","getSpeech","env","process","defaultSettings","name","threshold","preparationSeconds","cooldownSeconds","diffy","resolution","x","y","sensitivity","sourceDimensions","w","h","debug","getSettings","localStorage","storedSettings","getItem","JSON","parse","PunishmentStateMachine","state","preset","initialDuration","totalDuration","startedAt","events","speech","settings","violations","listeners","currentTime","cooldownEndTime","timer","currentTickMotionSum","currentTickMotionCount","reset","transition","startClock","Date","toISOString","range","penalty","stopClock","fromStates","toState","eventType","adjustment","indexOf","TypeError","time","speakRandomPhrase","updateListeners","forEach","listener","idx","penaltyProbability","lastIndex","window","setInterval","tick","clearInterval","magnitude","cooldownFinished","movementDetected","presetTitle","WelcomeScreen","props","fsm","className","onClick","onCustom","onPreset","onReport","href","target","rel","React","TextField","label","type","maxLength","value","onChange","helpText","SecondsField","ProbabilityField","step","MultiLineField","rows","serializeReport","report","serialize","serializePreset","deserializeReport","data","deserialize","deserializePreset","makeHeader","kind","makeFooter","obj","str","header","footer","longStr","lineLength","lines","line","slice","join","wrapLines","stringify","btoa","encodeURIComponent","replace","match","p1","String","fromCharCode","parseInt","trim","expectedHeader","expectedFooter","decodeURIComponent","atob","split","map","c","charCodeAt","toString","anyWindow","cornertime","Object","assign","PunishmentSetup","event","preventDefault","loadPreset","onChangeNumeric","currentTarget","parseFloat","stateChange","setState","onChangeText","onChangePenaltyProbabilities","rawValue","rawPenaltyProbabilities","e","onChangePhrases","rawName","charAt","toUpperCase","s","minimumDuration","maximumDuration","minimumPenalty","maximumPenalty","p","getReadyPhrases","rawGetReadyPhrases","startPhrases","rawStartPhrases","encouragePhrases","rawEncouragePhrases","scoldPhrases","rawScoldPhrases","penalizePhrases","rawPenalizePhrases","endPhrases","rawEndPhrases","onSubmit","onBack","serializedPreset","PunishmentLoader","isValid","disabled","cols","formatDuration","seconds","sign","minutes","formattedSeconds","hours","formattedMinutes","ReportCard","showMessage","filter","key","formatEventMessage","ReportViewer","reportSource","undefined","App","setupScreen","setUpCustom","viewReport","returnToWelcomeScreen","handleFsmUpdate","forceUpdate","handleMotionUpdate","matrix","row","addListener","create","onFrame","removeListener","timeLeft","ReactDOM","document","getElementById"],"mappings":"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","file":"static/js/main.9c81bdc4.chunk.js","sourcesContent":["export interface Preset {\n    title: string;\n    durationRange: {\n        minimum: number; // inclusive (all times are seconds)\n        maximum: number; // exclusive\n    };\n    penaltyRange: {\n        minimum: number;\n        maximum: number;\n    };\n\n    /**\n     * 0.1–1.0, per consecutive violation.\n     * first violation uses penaltyProbabilities[0], the next uses penaltyProbabilities[1] and so on.\n     * last element used when exhausted.\n     */\n    penaltyProbabilities: number[];\n\n    // TODO Make per phrase tunable?\n    // TODO Introduce different kinds of encouragements for different parts?\n    encouragementProbability: number;\n\n    phrases: Phrases;\n}\n\n\nexport const defaultPreset: Preset = {\n    title: 'Default Punishment',\n    durationRange: {\n        minimum: 600,\n        maximum: 900,\n    },\n    penaltyRange: {\n        minimum: 60,\n        maximum: 180,\n    },\n\n    // first violation will trigger a scold, subsequent ones will trigger penalties\n    penaltyProbabilities: [0.0, 1.0],\n\n    encouragementProbability: 0.1,\n    phrases: {\n        getReady: [\n            `You have been naughty. Get in the corner, facing the wall.`,\n        ],\n        start: [\n            `You better not move. I'm starting your punishment now.`,\n        ],\n        encourage: [\n            `You're doing fine. Keep it up and this will be over in no time.`,\n        ],\n        scold: [\n            `Do I see you moving?`,\n        ],\n        penalize: [\n            `I warned you not to move. I'm adding some more minutes in the clock.`,\n        ],\n        end: [\n            `You can come out of the corner now.`\n        ],\n    }\n};\n\n\nexport interface Phrases {\n    getReady: string[];\n    start: string[];\n    encourage: string[];\n    scold: string[];\n    penalize: string[];\n    end: string[];\n}\n\n\nexport type State = 'waiting' | 'preparation' | 'punishment' | 'cooldown' | 'finished';\nexport const allStates: State[] = ['waiting', 'preparation', 'punishment', 'cooldown', 'finished'];\nexport type EventType = 'getReady' | 'start' |  'scold' | 'encourage' | 'penalize' | 'end';\n\n\nexport interface Event {\n    eventType: EventType;\n    time: number;\n    adjustment: number;\n}\n\n\nexport interface Report {\n    name: string;\n    presetTitle: string;\n    initialDuration: number;\n    totalDuration: number;\n    startedAt: string; // ISO-8601 timestamp\n    events: Event[];\n    violations: number; // equals the number of total scold and penalize events\n}\n","export function randomInteger(min: number, max: number): number {\n    return Math.floor(Math.random() * (max - min) + min);\n}\n\n\nexport function randomElement<T>(items: T[]): T {\n    return items[randomInteger(0, items.length)];\n}\n","import { randomElement } from './random';\n\n\nexport interface Speech {\n    speak(phrase: string, context: object): void;\n    speakRandomPhrase(phrases: string[], context: object): void;\n}\n\n\nexport class BrowserSpeech implements Speech {\n    // TODO voice selection\n\n    speak(phrase: string, context: object) {\n        // TODO render template\n        const utter = new SpeechSynthesisUtterance(phrase);\n        speechSynthesis.speak(utter);\n    }\n\n    speakRandomPhrase(phrases: string[], context: object) {\n        const phrase = randomElement(phrases);\n        this.speak(phrase, context);\n    }\n}\n\n\nexport class MockSpeech {\n    transcript: string[] = [];\n\n    reset() {\n        this.transcript = [];\n    }\n\n    speak(phrase: string, context: object) {\n        // TODO render template\n        this.transcript.push(phrase);\n    }\n\n    speakRandomPhrase(phrases: string[], context: object) {\n        if (phrases.length === 0) {\n            return;\n        }\n\n        const phrase = randomElement(phrases);\n        this.speak(phrase, context);\n    }\n}\n\n\nexport default function getSpeech(env: string = process.env.NODE_ENV!): Speech {\n    if (env === 'test') {\n        return new MockSpeech();\n    } else {\n        return new BrowserSpeech();\n    }\n}\n","export interface Settings {\n    /**\n     * Diffy returns us a NxM matrix. We take maximum movement of that and average it over 1s.\n     * This is the threshold between 0.0 and 1.0 that average must cross in order to be considered\n     * movement.\n     */\n    threshold: number; // between 0.0–1.0\n    name: string;\n    preparationSeconds: number;\n    cooldownSeconds: number;\n\n    /**\n     * These parameters are given as-is to diffy.js, the movement detection library.\n     */\n    diffy: {\n        /**\n         * any number between 0 and 255 can be used. But ahem magic numbers are around 20 and 25.\n         * Experiment with this. This parameter defines the minimum average value that registers\n         * as \"movement\" for Diffy.js\n         */\n        threshold: number;\n\n        /**\n         * sensitivity (number) [default: 0.2] - a decimal value between 0 and 1. It impacts the\n         * contrast of the blended image. Somewhere around 0.2 is usually good. yay magic numbers!\n         */\n        sensitivity: number;\n\n        /**\n         * defines the dimensions for the source frame. Keep in mind that the larger the dimensions,\n         * the more pixels Diffy.js needs to examine, hence the lower the performance.\n         */\n        sourceDimensions: {\n            w: number;\n            h: number;\n        };\n\n        /**\n         * defines the size of the output matrix. generally a denser output matrix makes us notice\n         * smaller movement (note ../threshold though).\n         */\n        resolution: {\n            x: number;\n            y: number;\n        };\n\n        /**\n         * Show or hide the debug window\n         */\n        debug: boolean;\n    };\n}\n\n\nconst defaultSettings: Settings = {\n    name: 'Anonymous',\n    threshold: 0.3,\n    preparationSeconds: 10,\n    cooldownSeconds: 5,\n    diffy: {\n        resolution: { x: 10, y: 10 },\n        sensitivity: 0.2,\n        threshold: 21,\n        sourceDimensions: { w: 130, h: 100 },\n        // debug: process.env.NODE_ENV !== 'production',\n        debug: false,\n    },\n};\n\n\nexport default function getSettings(): Settings {\n    if (typeof localStorage !== 'undefined') {\n        const storedSettings = localStorage.getItem('settings');\n        if (storedSettings) {\n            return JSON.parse(storedSettings);\n        }\n    }\n\n    return defaultSettings;\n}\n","import { Preset, Event, EventType, State, defaultPreset, Report } from './models';\nimport { randomInteger } from './random';\nimport getSpeech from './speech';\nimport getSettings from './settings';\n\n\nexport type Listener = () => void;\n\nconst PREPARATION_SECONDS = 10;\nconst COOLDOWN_SECONDS = 5;\n\n\nexport default class PunishmentStateMachine {\n    preset: Preset = defaultPreset;\n    initialDuration: number = 0;\n    totalDuration: number = 0;\n    startedAt: string = ''; // ISO-8601 timestamp\n    events: Event[] = [];\n    state: State = 'waiting';\n    speech = getSpeech();\n    context = {};\n    settings = getSettings();\n    violations = 0;\n    listeners: Listener[] = [];\n    currentTime = 0;\n    cooldownEndTime = 0;\n    timer = 0;\n    currentTickMotionSum = 0;\n    currentTickMotionCount = 0;\n\n    public get currentTickMotionAverage() {\n        if (this.currentTickMotionCount === 0) {\n            return 0;\n        } else {\n            return this.currentTickMotionSum / this.currentTickMotionCount;\n        }\n    }\n\n    public get timeLeft() {\n        return this.totalDuration - this.currentTime;\n    }\n\n    /**\n     * @param state For testing. Production use should always reset to 'waiting'.\n     */\n    constructor(state: State = 'waiting') {\n        this.reset(state);\n    }\n\n    /**\n     * @param state For testing. Production use should always reset to 'waiting'.\n     */\n    reset(state: State = 'waiting') {\n        this.initialDuration = randomInteger(\n            this.preset.durationRange.minimum,\n            this.preset.durationRange.maximum,\n        );\n        this.totalDuration = this.initialDuration;\n        this.startedAt = '';\n        this.events = [];\n        this.state = state;\n        this.context = {}; // TODO\n        this.settings = getSettings();\n        this.violations = 0;\n        this.cooldownEndTime = 0;\n        this.currentTime = -PREPARATION_SECONDS;\n        this.currentTickMotionSum = 0;\n        this.currentTickMotionCount = 0;\n    }\n\n    loadPreset(preset: Preset) {\n        this.preset = preset;\n        this.reset();\n    }\n\n    // BEGIN STATE TRANSITION METHODS\n\n    getReady() {\n        this.transition(['waiting'], 'preparation', 'getReady');\n        this.startClock();\n    }\n\n    start() {\n        this.transition(['preparation'], 'punishment', 'start');\n        this.startedAt = (new Date()).toISOString();\n    }\n\n    scold() {\n        this.transition(['punishment'], 'cooldown', 'scold');\n    }\n\n    penalize() {\n        const range = this.preset.penaltyRange;\n        const penalty = randomInteger(range.minimum, range.maximum);\n        this.transition(['punishment'], 'cooldown', 'penalize', penalty);\n    }\n\n    cooldownFinished() {\n        this.transition(['cooldown'], 'punishment');\n    }\n\n    end() {\n        this.transition(['punishment', 'cooldown'], 'finished', 'end');\n        this.stopClock();\n    }\n\n    // END STATE TRANSITION METHODS\n\n    transition(fromStates: State[], toState: State, eventType?: EventType, adjustment: number = 0) {\n        if (fromStates.indexOf(this.state) < 0) {\n            throw new TypeError(`cannot go to ${toState} from ${this.state}`);\n        }\n\n        this.state = toState;\n        this.totalDuration += adjustment;\n\n        if (!eventType) {\n            return;\n        }\n\n        this.events.push({\n            adjustment,\n            eventType,\n            time: this.currentTime,\n        });\n\n        const phrases = this.preset.phrases[eventType];\n        if (phrases.length > 0) {\n            this.speech.speakRandomPhrase(phrases, this.context);\n        }\n\n        this.updateListeners();\n    }\n\n    updateListeners() {\n        this.listeners.forEach(listener => listener());\n    }\n\n    addListener(listener: Listener) {\n        this.listeners.push(listener);\n    }\n\n    removeListener(listener: Listener) {\n        const idx = this.listeners.indexOf(listener);\n        if (idx >= 0) {\n            delete this.listeners[idx];\n        }\n    }\n\n    encourage() {\n        if (this.state !== 'punishment') {\n            throw new TypeError(`cannot encourage in state ${this.state}`);\n        } else if (this.preset.phrases.encourage.length === 0) {\n            return;\n        }\n\n        this.events.push({\n            eventType: 'encourage',\n            adjustment: 0,\n            time: this.currentTime,\n        });\n        this.speech.speakRandomPhrase(this.preset.phrases.encourage, this.context);\n\n        this.updateListeners();\n    }\n\n    movementDetected() {\n        if (this.state !== 'punishment') {\n            return;\n        }\n\n        let penaltyProbability = this.preset.penaltyProbabilities[this.violations];\n        this.violations += 1;\n        this.cooldownEndTime = this.currentTime + COOLDOWN_SECONDS;\n\n        if (typeof penaltyProbability === 'undefined') {\n            const lastIndex = this.preset.penaltyProbabilities.length - 1;\n            penaltyProbability = this.preset.penaltyProbabilities[lastIndex];\n        }\n\n        if (Math.random() < penaltyProbability) {\n            this.penalize();\n        } else {\n            this.scold();\n        }\n    }\n\n    startClock() {\n        if (process.env.NODE_ENV === 'test') {\n            return;\n        }\n\n        this.timer = window.setInterval(() => this.tick(), 1000);\n    }\n\n    stopClock() {\n        if (process.env.NODE_ENV === 'test') {\n            return;\n        }\n\n        window.clearInterval(this.timer);\n    }\n\n    handleMotionUpdate(magnitude: number) {\n        if (this.state !== 'punishment') {\n            return;\n        }\n\n        this.currentTickMotionSum += magnitude;\n        this.currentTickMotionCount += 1;\n    }\n\n    tick() {\n        this.currentTime += 1;\n\n        switch (this.state) {\n            case 'preparation':\n                if (this.currentTime >= 0) {\n                    this.start();\n                }\n                break;\n\n\n            case 'cooldown':\n                if (this.currentTime >= this.totalDuration) {\n                    this.end();\n                } else if (this.currentTime >= this.cooldownEndTime) {\n                    this.cooldownFinished();\n                }\n                break;\n\n            case 'punishment':\n                if (this.currentTime >= this.totalDuration) {\n                    this.end();\n                } else if (this.currentTickMotionSum > this.settings.threshold) {\n                    this.movementDetected();\n                } else if (this.currentTime % 60 === 0 && Math.random() < this.preset.encouragementProbability) {\n                    // On full minutes there is a chance of receiving encouragement.\n                    this.encourage();\n                }\n                break;\n\n            case 'waiting':\n            case 'finished':\n            default:\n                throw TypeError(`Clock should not be running in ${this.state}`);\n        }\n\n        this.currentTickMotionSum = 0;\n\n        this.updateListeners();\n    }\n\n    report(): Report {\n        if (this.state !== 'finished') {\n            throw new TypeError(`report is not available in ${this.state}`);\n        }\n\n        return {\n            name: this.settings.name,\n            presetTitle: this.preset.title,\n            initialDuration: this.initialDuration,\n            totalDuration: this.totalDuration,\n            startedAt: this.startedAt,\n            events: this.events,\n            violations: this.violations,\n        };\n    }\n}\n","import PunishmentStateMachine from '../state';\nimport * as React from 'react';\n\n\ninterface WelcomeScreenProps {\n    fsm: PunishmentStateMachine;\n    onCustom(): void;\n    onPreset(): void;\n    onReport(): void;\n}\n\n\nexport default class WelcomeScreen extends React.Component<WelcomeScreenProps, {}> {\n    render() {\n        return (\n            <div className=\"container my-4\">\n                <div className=\"jumbotron\">\n                    <h1 className=\"display-3\">Corner Time!</h1>\n                    <p className=\"lead\">\n                        So you have been naughty? I will put you in the corner and use your\n                        webcam to make sure you do not move!\n                    </p>\n                    <button className=\"btn btn-primary btn-block btn-lg my-4\" onClick={this.start}>\n                        Start a 10–15 Minute Punishment Now\n                    </button>\n                    <p className=\"text-muted text-center\"><small>\n                        There will be voice instructions. Set your webcam 2–3 meters away from where you will be\n                        standing. Make sure your computer will not lock or sleep (OS X: <code>caffeinate -d</code>).\n                    </small></p>\n                    <p className=\"text-muted text-center\"><small>\n                        Don't worry! Video from your webcam <strong>will not be sent</strong> over the Internet.{' '}\n                    </small></p>\n                    <p className=\"text-center\">\n                        <button className=\"btn btn-link\" onClick={this.props.onCustom}>\n                            Design a Custom Punishment\n                        </button>\n                        <button className=\"btn btn-link\" onClick={this.props.onPreset}>\n                            Carry Out a Custom Punishment\n                        </button>\n                        <button className=\"btn btn-link\" onClick={this.props.onReport}>\n                            View a Punishment Report\n                        </button>\n                    </p>\n                </div>\n\n                <p className=\"text-muted text-center\"><small>\n                    <strong>2019-05-07:</strong> The application works in modern browsers again!\n                </small></p>\n                <p className=\"text-muted text-center\"><small>\n                    <a href=\"https://github.com/cornertime/cornertime\" target=\"_blank\" rel=\"noopener noreferrer\">Source Code</a>\n                </small></p>\n            </div>\n        );\n    }\n\n    start = () => this.props.fsm.getReady();\n}\n","import * as React from 'react';\n\n\nexport interface FieldProps {\n    name: string;\n    label: string;\n    helpText?: string;\n}\n\n\nexport interface TextFieldProps extends FieldProps {\n    value: string;\n    onChange(event: React.FormEvent<HTMLInputElement>): void;\n}\n\n\nexport const TextField = (props: TextFieldProps) => (\n    <div className=\"form-group row\">\n        <label className=\"col-sm-3 col-form-label\">{props.label}</label>\n        <div className=\"col-sm-9\">\n            <input\n                className=\"form-control\"\n                name={props.name}\n                type=\"text\"\n                maxLength={255}\n                value={props.value}\n                onChange={props.onChange}\n            />\n            {props.helpText ? <small className=\"form-text text-muted\">{props.helpText}</small> : null}\n        </div>\n    </div>\n);\n\n\nexport interface NumericFieldProps extends FieldProps {\n    value: number;\n    onChange(event: React.FormEvent<HTMLInputElement>): void;\n}\n\n\nexport const SecondsField = (props: NumericFieldProps) => (\n    <div className=\"form-group row\">\n        <label className=\"col-sm-3 col-form-label\">{props.label}</label>\n        <div className=\"col-sm-9\">\n            <input\n                className=\"form-control\"\n                name={props.name}\n                type=\"number\"\n                min={0}\n                max={86400}\n                value={props.value}\n                onChange={props.onChange}\n            />\n            {props.helpText ? <small className=\"form-text text-muted\">{props.helpText}</small> : null}\n        </div>\n    </div>\n);\n\n\nexport const ProbabilityField = (props: NumericFieldProps) => (\n    <div className=\"form-group row\">\n        <label className=\"col-sm-3 col-form-label\">{props.label}</label>\n        <div className=\"col-sm-9\">\n            <input\n                className=\"form-control\"\n                name={props.name}\n                type=\"number\"\n                min={0.0}\n                max={1.0}\n                step={0.01}\n                value={props.value}\n                onChange={props.onChange}\n            />\n            {props.helpText ? <small className=\"form-text text-muted\">{props.helpText}</small> : null}\n        </div>\n    </div>\n);\n\n\nexport interface MultiLineFieldProps extends FieldProps {\n    value: string;\n    onChange(event: React.FormEvent<HTMLTextAreaElement>): void;\n}\n\n\nexport const MultiLineField = (props: MultiLineFieldProps) => (\n    <div className=\"form-group row\">\n        <label className=\"col-sm-3 col-form-label\">{props.label}</label>\n        <div className=\"col-sm-9\">\n            <textarea\n                rows={6}\n                className=\"form-control\"\n                name={props.name}\n                value={props.value}\n                onChange={props.onChange}\n            />\n            {props.helpText ? <small className=\"form-text text-muted\">{props.helpText}</small> : null}\n        </div>\n    </div>\n);\n","import { Report, Preset } from './models';\n\n\nconst LINE_LENGTH = 76;\ntype Kind = 'PUNISHMENT REPORT' | 'CUSTOM PUNISHMENT';\n\n\n// Public API of this module\n\nexport function serializeReport(report: Report): string {\n    return serialize(report, 'PUNISHMENT REPORT');\n}\n\nexport function serializePreset(preset: Preset): string {\n    return serialize(preset, 'CUSTOM PUNISHMENT');\n}\n\n\nexport function deserializeReport(data: string): Report {\n    return deserialize(data, 'PUNISHMENT REPORT');\n}\n\nexport function deserializePreset(data: string): Preset {\n    return deserialize(data, 'CUSTOM PUNISHMENT');\n}\n\n// The rest are exported only for testing\n\n\nfunction makeHeader(kind: Kind) {\n    return `-----BEGIN CORNERTIME ${kind}-----`;\n}\n\nfunction makeFooter(kind: Kind) {\n    return `-----END CORNERTIME ${kind}-----`;\n}\n\n\n// https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\nexport function encodeBase64(str: string): string {\n    // first we use encodeURIComponent to get percent-encoded UTF-8,\n    // then we convert the percent encodings into raw bytes which\n    // can be fed into btoa.\n    return btoa(encodeURIComponent(str).replace(\n        /%([0-9A-F]{2})/g,\n        (match, p1) => String.fromCharCode(parseInt('0x' + p1, 16)),\n    ));\n}\n\n\nexport function decodeBase64(str: string) {\n    // Going backwards: from bytestream, to percent-encoding, to original string.\n    return decodeURIComponent(\n        atob(str).split('').map(c =>  '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join('')\n    );\n}\n\n\nexport function wrapLines(longStr: string, lineLength: number = LINE_LENGTH): string {\n    const lines: string[] = [];\n    let start = 0;\n\n    let line = '';\n    while ((line = longStr.slice(start, start + lineLength))) {\n        lines.push(line);\n        start += lineLength;\n    }\n\n    return lines.join('\\n');\n}\n\n\nexport function serialize(obj: object, kind: Kind): string {\n    const header = makeHeader(kind);\n    const footer = makeFooter(kind);\n    const data = wrapLines(encodeBase64(JSON.stringify(obj)));\n    return `${header}\\n${data}\\n${footer}`;\n}\n\nexport function deserialize(data: string, kind: Kind): any {\n    data = data.trim();\n\n    const expectedHeader = makeHeader(kind);\n    const expectedFooter = makeFooter(kind);\n\n    if (data.slice(0, expectedHeader.length) !== expectedHeader) {\n        throw new TypeError('data to deserialize does not start with our header');\n    }\n\n    if (data.slice(data.length - expectedFooter.length) !== expectedFooter) {\n        throw new TypeError('data to deserialize does not end with our footer');\n    }\n\n    // remove header and footer\n    data = data.slice(expectedHeader.length, data.length - expectedFooter.length);\n    data = decodeBase64(data);\n\n    // TODO Schema validation\n    return JSON.parse(data);\n}\n\n\n// Debug globals\nif (typeof window !== 'undefined') {\n    const anyWindow: any = window;\n    anyWindow.cornertime = anyWindow.cornertime || {};\n    Object.assign(anyWindow.cornertime, {\n        serializePreset,\n        serializeReport,\n        deserializePreset,\n        deserializeReport,\n    });\n}\n","import PunishmentStateMachine from '../state';\nimport * as React from 'react';\nimport { TextField, SecondsField, ProbabilityField, MultiLineField } from '../forms';\nimport { serializePreset } from '../serialization';\n\n\ninterface PunishmentSetupProps {\n    fsm: PunishmentStateMachine;\n    onBack(): void;\n}\n\ninterface PunishmentSetupState {\n    title: string;\n    minimumDuration: number;\n    maximumDuration: number;\n    minimumPenalty: number;\n    maximumPenalty: number;\n    encouragementProbability: number;\n\n    penaltyProbabilities: number[];\n    rawPenaltyProbabilities: string;\n\n    getReadyPhrases: string[];\n    rawGetReadyPhrases: string;\n\n    startPhrases: string[];\n    rawStartPhrases: string;\n\n    encouragePhrases: string[];\n    rawEncouragePhrases: string;\n\n    scoldPhrases: string[];\n    rawScoldPhrases: string;\n\n    penalizePhrases: string[];\n    rawPenalizePhrases: string;\n\n    endPhrases: string[];\n    rawEndPhrases: string;\n}\n\n\nexport default class PunishmentSetup extends React.Component<PunishmentSetupProps, PunishmentSetupState> {\n    constructor(props: PunishmentSetupProps) {\n        super(props);\n\n        const preset = props.fsm.preset;\n\n        this.state = {\n            title: preset.title === 'Default Punishment' ? 'Custom Punishment' : preset.title,\n            minimumDuration: preset.durationRange.minimum,\n            maximumDuration: preset.durationRange.maximum,\n            minimumPenalty: preset.penaltyRange.minimum,\n            maximumPenalty: preset.penaltyRange.maximum,\n            encouragementProbability: preset.encouragementProbability,\n            penaltyProbabilities: preset.penaltyProbabilities,\n            rawPenaltyProbabilities: preset.penaltyProbabilities.map(p => '' + p).join(' '),\n\n            getReadyPhrases: preset.phrases.getReady,\n            rawGetReadyPhrases: preset.phrases.getReady.join('\\n'),\n\n            startPhrases: preset.phrases.start,\n            rawStartPhrases: preset.phrases.start.join('\\n'),\n\n            encouragePhrases: preset.phrases.encourage,\n            rawEncouragePhrases: preset.phrases.encourage.join('\\n'),\n\n            scoldPhrases: preset.phrases.scold,\n            rawScoldPhrases: preset.phrases.scold.join('\\n'),\n\n            penalizePhrases: preset.phrases.penalize,\n            rawPenalizePhrases: preset.phrases.penalize.join('\\n'),\n\n            endPhrases: preset.phrases.end,\n            rawEndPhrases: preset.phrases.end.join('\\n'),\n        };\n    }\n\n    render() {\n        return (\n            <div className=\"container my-4\">\n                <h2>Design a Custom Punishment</h2>\n\n                <form onSubmit={this.start} className=\"form\">\n                    <div className=\"row mt-3 mb-5\">\n                        <div className=\"col-md-10\">\n                            <button className=\"btn btn-primary btn-block btn-lg\" type=\"submit\">\n                                Start the Custom Punishment Now\n                            </button>\n                        </div>\n                        <div className=\"col-md-2\">\n                            <button className=\"btn btn-secondary btn-block btn-lg\" onClick={this.props.onBack}>\n                                Back\n                            </button>\n                        </div>\n                    </div>\n\n                    <TextField\n                        name=\"title\"\n                        label=\"Title of the custom punishment\"\n                        helpText=\"This is the only field that will be disclosed to the receiver before punishment.\"\n                        value={this.state.title}\n                        onChange={this.onChangeText}\n                    />\n\n                    <SecondsField\n                        name=\"minimumDuration\"\n                        label=\"Minimum duration (seconds)\"\n                        value={this.state.minimumDuration}\n                        onChange={this.onChangeNumeric}\n                    />\n\n                    <SecondsField\n                        name=\"maximumDuration\"\n                        label=\"Maximum duration (seconds)\"\n                        helpText=\"The duration of the punishment will be picked randomly within these bounds.\"\n                        value={this.state.maximumDuration}\n                        onChange={this.onChangeNumeric}\n                    />\n\n                    {/* TODO Richer field type */}\n                    <TextField\n                        name=\"penaltyProbabilities\"\n                        label=\"Penalty probabilities\"\n                        helpText={`Probability of penalty for each consecutive movement violation, separated by\n                                   whitespace. The first violation will use the first value, the second violation\n                                   will use the second value and so on until values run out, after which the last\n                                   value is used for any subsequent violations.`}\n                        value={this.state.rawPenaltyProbabilities}\n                        onChange={this.onChangePenaltyProbabilities}\n                    />\n\n                    <SecondsField\n                        name=\"minimumPenalty\"\n                        label=\"Minimum penalty (seconds)\"\n                        value={this.state.minimumPenalty}\n                        onChange={this.onChangeNumeric}\n                    />\n\n                    <SecondsField\n                        name=\"maximumPenalty\"\n                        label=\"Maximum penalty (seconds)\"\n                        value={this.state.maximumPenalty}\n                        onChange={this.onChangeNumeric}\n                        helpText={`When a penalty is given for moving, the time adjustment will be picked randomly\n                                   within these bounds.`}\n                    />\n\n                    <ProbabilityField\n                        name=\"encouragementProbability\"\n                        label=\"Encouragement probability\"\n                        value={this.state.encouragementProbability}\n                        onChange={this.onChangeNumeric}\n                        helpText={`At each full minute, there is a chance of receiving encouragement in the form of\n                                   one of the encouragement phrases. This field controls that probability.`}\n                    />\n\n                    <MultiLineField\n                        name=\"getReadyPhrases\"\n                        label=\"Get Ready phrases\"\n                        helpText={`One of these phrases will be spoken at random at the start of the preparation delay,\n                                   during which the person being punished is supposed to walk to the corner and assume\n                                   a position they can hold for the remainder of the punishment. One phrase per line.`}\n                        value={this.state.rawGetReadyPhrases}\n                        onChange={this.onChangePhrases}\n                    />\n\n                    <MultiLineField\n                        name=\"startPhrases\"\n                        label=\"Starting phrases\"\n                        helpText={`One of these phrases will be spoken at random at the start of the punishment.\n                                   One phrase per line.`}\n                        value={this.state.rawStartPhrases}\n                        onChange={this.onChangePhrases}\n                    />\n\n                    <MultiLineField\n                        name=\"scoldPhrases\"\n                        label=\"Scolding phrases\"\n                        helpText={`One of these phrases will be spoken at random when movement has been detected but\n                                   a penalty has not been triggered.`}\n                        value={this.state.rawScoldPhrases}\n                        onChange={this.onChangePhrases}\n                    />\n\n                    <MultiLineField\n                        name=\"penalizePhrases\"\n                        label=\"Penalty phrases\"\n                        helpText={`One of these phrases will be spoken at random when movement has been detected and\n                                   a penalty has been triggered.`}\n                        value={this.state.rawPenalizePhrases}\n                        onChange={this.onChangePhrases}\n                    />\n\n                    <MultiLineField\n                        name=\"encouragePhrases\"\n                        label=\"Encouragement phrases\"\n                        helpText={`One of these phrases may be spoken at random at any full minute as specified by the\n                                   encouragement probability.`}\n                        value={this.state.rawEncouragePhrases}\n                        onChange={this.onChangePhrases}\n                    />\n\n                    <MultiLineField\n                        name=\"endPhrases\"\n                        label=\"Ending phrases\"\n                        helpText={`One of these phrases will be spoken at random when the punishment is finished.`}\n                        value={this.state.rawEndPhrases}\n                        onChange={this.onChangePhrases}\n                    />\n                </form>\n\n                <p className=\"mt-5\">\n                    To have someone else use this preset without seeing its content, give this to them and instruct\n                    them to use the \"I Have a Custom Punishment\" link from the welcome screen.\n                </p>\n\n                <pre>{this.serializedPreset}</pre>\n            </div>\n        );\n    }\n\n    start = (event: React.MouseEvent<HTMLButtonElement> | React.FormEvent<HTMLFormElement>) => {\n        event.preventDefault();\n\n        const fsm = this.props.fsm;\n\n        fsm.loadPreset(this.preset);\n        fsm.getReady();\n    }\n\n    public get preset() {\n        return {\n            title: this.state.title,\n            durationRange: {\n                minimum: this.state.minimumDuration,\n                maximum: this.state.maximumDuration,\n            },\n            penaltyProbabilities: this.state.penaltyProbabilities,\n            penaltyRange: {\n                minimum: this.state.minimumPenalty,\n                maximum: this.state.maximumPenalty,\n            },\n            encouragementProbability: this.state.encouragementProbability,\n            phrases: {\n                getReady: this.state.getReadyPhrases,\n                start: this.state.startPhrases,\n                scold: this.state.scoldPhrases,\n                penalize: this.state.penalizePhrases,\n                encourage: this.state.encouragePhrases,\n                end: this.state.endPhrases,\n            }\n        };\n    }\n\n    public get serializedPreset() {\n        return serializePreset(this.preset);\n    }\n\n    onChangeNumeric = (event: React.FormEvent<HTMLInputElement>) => {\n        const name = event.currentTarget.name;\n        const value = parseFloat(event.currentTarget.value);\n        const stateChange: any = { [name]: value };\n\n        this.setState(stateChange);\n    }\n\n    onChangeText = (event: React.FormEvent<HTMLInputElement>) => {\n        const name = event.currentTarget.name;\n        const value = event.currentTarget.value;\n        const stateChange: any = { [name]: value };\n\n        this.setState(stateChange);\n    }\n\n    onChangePenaltyProbabilities = (event: React.FormEvent<HTMLInputElement>) => {\n        const rawValue = event.currentTarget.value;\n        const stateChange: any = { rawPenaltyProbabilities: rawValue };\n\n        try {\n            stateChange.penaltyProbabilities = rawValue.split(/\\s+/).map(parseFloat);\n        } catch (e) {\n            // noop\n        }\n\n        this.setState(stateChange);\n    }\n\n    onChangePhrases = (event: React.FormEvent<HTMLTextAreaElement>) => {\n        const name = event.currentTarget.name;\n\n        const rawName = `raw${name.charAt(0).toUpperCase()}${name.slice(1)}`;\n        const rawValue = event.currentTarget.value;\n\n        const phrases = rawValue.split('\\n').map(s => s.trim());\n\n        const stateChange: any = {\n            [name]: phrases,\n            [rawName]: rawValue,\n        };\n\n        this.setState(stateChange);\n    }\n}\n","import { deserializePreset } from '../serialization';\nimport PunishmentStateMachine from '../state';\nimport * as React from 'react';\n\n\ninterface PunishmentLoaderProps {\n    fsm: PunishmentStateMachine;\n    onBack(): void;\n}\n\ninterface PunishmentLoaderState {\n    preset: string;\n    isValid: boolean;\n}\n\n\nexport default class PunishmentLoader extends React.Component<PunishmentLoaderProps, PunishmentLoaderState> {\n    state = {\n        preset: '',\n        isValid: false,\n    };\n\n    render() {\n        return (\n            <div className=\"container my-4\">\n                <h2>Carry Out a Custom Punishment</h2>\n\n                <div className=\"row my-3\">\n                    <div className=\"col-md-10\">\n                        <button\n                            className=\"btn btn-primary btn-block btn-lg\"\n                            onClick={this.start}\n                            disabled={!this.state.isValid}\n                        >\n                            Start the Custom Punishment Now\n                        </button>\n                    </div>\n                    <div className=\"col-md-2\">\n                        <button className=\"btn btn-secondary btn-block btn-lg\" onClick={this.props.onBack}>\n                            Back\n                        </button>\n                    </div>\n                </div>\n\n                <form className=\"form\">\n                    <div className=\"form-group\">\n                        <label>Custom punishment:</label>\n                        <textarea\n                            className=\"form-control\"\n                            rows={24}\n                            cols={90}\n                            value={this.state.preset}\n                            onChange={this.onChange}\n                        />\n                        <small className=\"form-text text-muted\">\n                            In either JSON or \"BEGIN CORNERTIME CUSTOM PUNISHMENT\" format.\n                        </small>\n                    </div>\n                </form>\n            </div>\n        );\n    }\n\n    start = (event: React.MouseEvent<HTMLButtonElement>) => {\n        const fsm = this.props.fsm;\n\n        fsm.loadPreset(this.loadPreset());\n        fsm.getReady();\n    }\n\n    loadPreset() {\n        try {\n            return deserializePreset(this.state.preset);\n        } catch (e) {\n            return JSON.parse(this.state.preset);\n        }\n    }\n\n    onChange = (event: React.FormEvent<HTMLTextAreaElement>) => {\n        const preset = event.currentTarget.value;\n\n        let isValid = false;\n        try {\n            deserializePreset(preset);\n            isValid = true;\n        } catch (e) {\n            // noop;\n        }\n\n        this.setState({ preset, isValid });\n    }\n}\n","export function formatDuration(seconds: number): string {\n    let sign = '';\n    if (seconds < 0) {\n        sign = '-';\n        seconds = -seconds;\n    }\n\n    let minutes = Math.floor(seconds / 60);\n    seconds %= 60;\n    const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;\n\n    let hours = Math.floor(minutes / 60);\n    minutes %= 60;\n\n    if (hours) {\n        const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;\n        return `${sign}${hours}:${formattedMinutes}:${formattedSeconds}`;\n    } else {\n        return `${sign}${minutes}:${formattedSeconds}`;\n    }\n}\n","import * as React from 'react';\nimport { Report, Event } from '../models';\nimport { formatDuration } from '../time';\nimport { serializeReport } from '../serialization';\n\n\nfunction formatEventMessage(event: Event) {\n    switch (event.eventType) {\n        case 'getReady':\n            return `Preparation started.`;\n\n        case 'start':\n            return `Punishment started.`;\n\n        case 'scold':\n            return `Scolded for moving.`;\n\n        case 'encourage':\n            return `Encouragement given.`;\n\n        case 'penalize':\n            return `Penalized for moving. Time added: ${formatDuration(event.adjustment)}`;\n\n        case 'end':\n            return `Punishment finished.`;\n\n        default:\n            return `Unknown event type!`;\n    }\n}\n\n\ninterface ReportCardProps {\n    report: Report;\n    showMessage?: boolean;\n}\n\n\nexport default class ReportCard extends React.Component<ReportCardProps, {}> {\n    render() {\n        const report = this.props.report;\n\n        return (\n            <div className=\"container my-4\">\n                {this.props.showMessage ? (\n                    <div className=\"jumbotron\">\n                        <h1 className=\"display-3\">Your punishment is over.</h1>\n                        <p className=\"lead\">\n                            I hope you have learned your lesson. If not, I'll be seeing you again!\n                        </p>\n                        <a href=\"/\" className=\"btn btn-primary btn-block btn-lg\">\n                            I did not Learn My Lesson! I need another punishment.\n                        </a>\n                    </div>\n                ) : null}\n\n                <h2 className=\"my-3\">Punishment report</h2>\n\n                <table className=\"table\">\n                    <tbody>\n                        {/* <tr>\n                            <td>Name:</td>\n                            <td>{report.name}</td>\n                        </tr>\n\n                        <tr>\n                            <td>Preset:</td>\n                            <td>{report.presetTitle}</td>\n                        </tr> */}\n\n                        <tr>\n                            <td>Started at:</td>\n                            <td>{report.startedAt}</td>\n                        </tr>\n\n                        <tr>\n                            <td>Initial duration:</td>\n                            <td>{formatDuration(report.initialDuration)}</td>\n                        </tr>\n\n                        <tr>\n                            <td>Total duration:</td>\n                            <td>{formatDuration(report.totalDuration)}</td>\n                        </tr>\n\n                        <tr>\n                            <td>Number of movement violations:</td>\n                            <td>{report.violations}</td>\n                        </tr>\n                    </tbody>\n                </table>\n\n                <table className=\"table my-4\">\n                    <thead>\n                        <tr>\n                            <th className=\"text-right\">Time</th>\n                            <th>Event</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {report.events.filter(event =>\n                            event.eventType !== 'getReady' && event.eventType !== 'start'\n                        ).map(event => (\n                            <tr key={event.time}>\n                                <td className=\"text-right\">{formatDuration(event.time)}</td>\n                                <td>{formatEventMessage(event)}</td>\n                            </tr>\n                        ))}\n                    </tbody>\n                </table>\n\n                {this.props.showMessage ? (\n                    <div>\n                        <p className=\"my-4\"><small>\n                            If you were instructed by someone to take this punishment, you can give them this encoded\n                            report that contains the same information as you see above:\n                        </small></p>\n\n                        <pre>{serializeReport(report)}</pre>\n                    </div>\n                ) : null}\n            </div>\n        );\n    }\n}\n","import { deserializeReport } from '../serialization';\nimport * as React from 'react';\nimport { Report } from '../models';\nimport ReportCard from './ReportCard';\n\n\ninterface ReportViewerProps {\n    onBack(): void;\n}\n\n\ninterface ReportViewerState {\n    reportSource: string;\n    report?: Report;\n}\n\n\nexport default class ReportViewer extends React.Component<ReportViewerProps, ReportViewerState> {\n    state: ReportViewerState = {\n        reportSource: '',\n    };\n\n    render() {\n        return (\n            <div className=\"container my-4\">\n                <h2>View the Report of a Previous Punishment</h2>\n\n                <button className=\"btn btn-secondary btn-block btn-lg my-4\" onClick={this.props.onBack}>\n                    Back\n                </button>\n\n                <form className=\"form\">\n                    <div className=\"form-group\">\n                        <label>Punishment report:</label>\n                        <textarea\n                            className=\"form-control\"\n                            rows={12}\n                            cols={90}\n                            value={this.state.reportSource}\n                            onChange={this.onChange}\n                        />\n                        <small className=\"form-text text-muted\">\n                            If you instructed someone to take a punishment and received a punishment report\n                            from them, enter the report here to view its contents.\n                        </small>\n                    </div>\n                </form>\n\n                {this.state.report ? <ReportCard report={this.state.report} /> : null}\n            </div>\n        );\n    }\n\n    onChange = (event: React.FormEvent<HTMLTextAreaElement>) => {\n        let reportSource = event.currentTarget.value;\n        let report: Report | undefined = undefined;\n\n        try {\n            report = deserializeReport(reportSource);\n        } catch (e) {\n            // Wasn't a valid report. Won't show anything.\n        }\n\n        this.setState({ report, reportSource });\n    }\n}\n","import * as React from 'react';\nimport PunishmentStateMachine from '../state';\nimport getSettings from '../settings';\nimport { create } from 'diffyjs';\nimport WelcomeScreen from './WelcomeScreen';\nimport PunishmentSetup from './PunishmentSetup';\nimport PunishmentLoader from './PunishmentLoader';\nimport ReportCard from './ReportCard';\nimport ReportViewer from './ReportViewer';\n\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { formatDuration } from '../time';\n\n\nconst MOTION_MAX = 255;\ntype SetupScreen = 'default' | 'custom' | 'report' | 'preset';\n\ninterface AppState {\n    setupScreen: SetupScreen;\n}\n\n\nclass App extends React.Component<{}, AppState> {\n    fsm = new PunishmentStateMachine();\n    settings = getSettings();\n    diffy: any;\n\n    state: AppState = {\n        setupScreen: 'default',\n    };\n\n    componentDidMount() {\n        this.fsm.addListener(this.handleFsmUpdate);\n\n        // Debug globals\n        if (typeof window !== 'undefined') {\n            const anyWindow: any = window;\n            anyWindow.cornertime = anyWindow.cornertime || {};\n            anyWindow.cornertime.fsm = this.fsm;\n        }\n\n        if (process.env.NODE_ENV !== 'test') {\n            this.diffy = create({\n                ...this.settings.diffy,\n                onFrame: matrix => this.handleMotionUpdate(matrix),\n            });\n        }\n    }\n\n    componentWillUnmount() {\n        this.fsm.removeListener(this.handleFsmUpdate);\n    }\n\n    render() {\n        const fsm = this.fsm;\n\n        switch (fsm.state) {\n            case 'waiting':\n                switch (this.state.setupScreen) {\n                    case 'custom':\n                        return <PunishmentSetup fsm={fsm} onBack={this.returnToWelcomeScreen} />;\n                    case 'preset':\n                        return <PunishmentLoader fsm={fsm} onBack={this.returnToWelcomeScreen} />;\n                    case 'report':\n                        return <ReportViewer onBack={this.returnToWelcomeScreen} />;\n                    default:\n                        return (\n                            <WelcomeScreen\n                                fsm={fsm}\n                                onCustom={this.setUpCustom}\n                                onPreset={this.loadPreset}\n                                onReport={this.viewReport}\n                            />\n                        );\n                }\n\n            case 'preparation':\n                return (\n                    <h1 className=\"display-2 my-5 text-center\">\n                        The punishment will start in {formatDuration(-fsm.currentTime)}.\n                    </h1>\n                );\n\n            case 'punishment':\n            case 'cooldown':\n                return <h1 className=\"display-1 my-5 text-center\">{formatDuration(fsm.timeLeft)}</h1>;\n\n            case 'finished':\n                return <ReportCard report={fsm.report()} showMessage={true} />;\n\n            default:\n                return null;\n        }\n    }\n\n    setUpCustom = () => this.setState({ setupScreen: 'custom' });\n    viewReport = () => this.setState({ setupScreen: 'report' });\n    loadPreset = () => this.setState({ setupScreen: 'preset' });\n    returnToWelcomeScreen = () => this.setState({ setupScreen: 'default' });\n\n    handleFsmUpdate = () => {\n        this.forceUpdate();\n    }\n\n    handleMotionUpdate = (matrix: number[][]) => {\n        // matrix elements seem to be 0–255 with 255 meaning \"no movement\", 0 meaning \"chaos\"\n        // we turn it into a a single number 0.0–1.0 by taking busiest cell\n        const minValue = Math.min(...matrix.map(row => Math.min(...row)));\n        const magnitude = (MOTION_MAX - minValue) / MOTION_MAX;\n        this.fsm.handleMotionUpdate(magnitude);\n    }\n}\n\nexport default App;\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport App from './components/App';\nimport './index.css';\n\n\nReactDOM.render(\n    <App />,\n    document.getElementById('root') as HTMLElement\n);\n"],"sourceRoot":""}